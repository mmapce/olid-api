<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OLID â€“ Offensive Language Detector</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-zinc-950 text-zinc-100 min-h-screen">
  <div class="max-w-3xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-2xl font-bold">Tweet / Text Classifier</h1>
      <p class="text-sm text-zinc-400">Enter text (or multiple lines for batch). Model hosted on Cloud Run.</p>
    </header>

    <section class="space-y-3">
      <textarea id="input" rows="6" placeholder="Type a sentence or paste one-per-line for batchâ€¦"
        class="w-full rounded-xl bg-zinc-900 border border-zinc-800 p-4 outline-none focus:ring-2 focus:ring-indigo-500"></textarea>

      <div class="flex items-center gap-3">
        <button id="btn" class="px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 font-medium">
          Predict
        </button>
        <label class="flex items-center gap-2 text-sm text-zinc-400">
          <span>Threshold</span>
          <input id="thr" type="number" step="0.01" min="0" max="1" value="0.39"
            class="w-20 rounded bg-zinc-900 border border-zinc-800 px-2 py-1">
        </label>
        <span id="status" class="text-sm text-zinc-400"></span>
      </div>
    </section>

    <section id="single" class="mt-6 hidden">
      <div class="rounded-2xl border border-zinc-800 bg-zinc-900 p-5">
        <div class="text-sm text-zinc-400 mb-2">Result</div>
        <div id="singleText" class="text-lg mb-3"></div>
        <div class="flex flex-wrap gap-4">
          <div class="px-3 py-1 rounded-full text-sm" id="labelBadge"></div>
          <div class="text-sm text-zinc-300" id="prob"></div>
        </div>
      </div>
    </section>

    <section id="tableWrap" class="mt-6 hidden">
      <div class="rounded-2xl border border-zinc-800 overflow-hidden">
        <table class="min-w-full text-sm">
          <thead class="bg-zinc-900/80">
            <tr>
              <th class="p-3 text-left">#</th>
              <th class="p-3 text-left">Text</th>
              <th class="p-3 text-left">Prediction</th>
              <th class="p-3 text-left">Prob (foul)</th>
            </tr>
          </thead>
          <tbody id="tbody" class="bg-zinc-900/40"></tbody>
        </table>
      </div>
    </section>

    <footer class="mt-10 text-xs text-zinc-500">
      <span>OLID FastAPI â€¢ </span><a class="underline" target="_blank" id="docsLink">/docs</a>
    </footer>
  </div>

  <script>
    // ðŸ”§ SET THIS: your Cloud Run URL (no trailing slash)
    const API_URL = "hhttps://olid-api-1078757655479.europe-west1.run.app/docs";
    document.getElementById("docsLink").href = API_URL + "/docs";

    const el = (id) => document.getElementById(id);
    const btn = el("btn"), input = el("input"), thr = el("thr"), status = el("status");

    function badge(elm, pred) {
      elm.textContent = pred === 1 ? "FOUL (1)" : "PROPER (0)";
      elm.className = "px-3 py-1 rounded-full text-sm " + (pred === 1
        ? "bg-rose-600/20 text-rose-300 border border-rose-700/40"
        : "bg-emerald-600/20 text-emerald-300 border border-emerald-700/40");
    }

    async function predictSingle(text, threshold) {
      const res = await fetch(API_URL + "/predict", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ text, threshold: parseFloat(threshold) })
      });
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    }

    async function predictBatch(lines, threshold) {
      const res = await fetch(API_URL + "/predict/batch", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ texts: lines, threshold: parseFloat(threshold) })
      });
      if (!res.ok) throw new Error(await res.text());
      return res.json();
    }

    btn.addEventListener("click", async () => {
      const txt = input.value.trim();
      const threshold = thr.value || 0.39;
      if (!txt) return;

      status.textContent = "Predictingâ€¦";
      el("single").classList.add("hidden");
      el("tableWrap").classList.add("hidden");

      const lines = txt.split(/\r?\n/).map(s => s.trim()).filter(Boolean);

      try {
        if (lines.length === 1) {
          const data = await predictSingle(lines[0], threshold);
          el("singleText").textContent = lines[0];
          badge(el("labelBadge"), data.prediction);
          el("prob").textContent = `prob_foul = ${data.prob_foul.toFixed(3)}  â€¢  threshold = ${data.threshold}`;
          el("single").classList.remove("hidden");
        } else {
          const data = await predictBatch(lines, threshold);
          const tbody = el("tbody");
          tbody.innerHTML = "";
          data.results.forEach((r, i) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td class="p-3 align-top text-zinc-400">${i+1}</td>
              <td class="p-3 align-top">${lines[i].replace(/[<>&]/g, s => ({'<':'&lt;','>':'&gt;','&':'&amp;'}[s]))}</td>
              <td class="p-3 align-top">
                <span class="px-2 py-0.5 rounded text-xs ${r.prediction===1?'bg-rose-600/20 text-rose-300 border border-rose-700/40':'bg-emerald-600/20 text-emerald-300 border border-emerald-700/40'}">
                  ${r.prediction===1?'FOUL':'PROPER'}
                </span>
              </td>
              <td class="p-3 align-top">${Number(r.prob_foul).toFixed(3)}</td>`;
            tbody.appendChild(tr);
          });
          el("tableWrap").classList.remove("hidden");
        }
        status.textContent = "Done";
      } catch (e) {
        console.error(e);
        status.textContent = "Error: " + e.message;
        alert("Request failed:\n" + e.message);
      }
    });
  </script>
</body>
</html>